<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../ui/article-container.html">
<link rel="import" href="../ui/ui-tag.html">

<dom-module id="blog-entry">
    <template>
        <link rel="stylesheet" href="../../css/blog-entry.css">
        <article>
            <header>
                <h2 on-click="_navigate">{{model.title}}</h2>
                <h5>{{computedDate}}</h5>
                <div id="more">
                    <span class="icon-eye" on-click="_navigate"></span>
                </div>
            </header>
            <article-container text="{{model.body}}"></article-container>
            <footer>
                <template is="dom-repeat" items="{{model.tags}}" as="tag">
                    <ui-tag text="{{tag}}" on-click="_handleClick"></ui-tag>
                </template>
            </footer>
        </article>
    </template>
    <script>
        Polymer({
            is: 'blog-entry',
            properties: {
                model: Object,
                computedDate: {
                    type: String,
                    computed: '_computeDate(model.date)'
                }
            },
            _navigate: function () {
                window.location.hash = '#/blog/' + String(this.model.title).split(' ').join('-');
            },
            _computeDate: function (date) {
                date = new Date(date);
                var day = date.getDate();
                var month = date.getMonth() + 1;
                var year = date.getFullYear();
                var hours = date.getHours();
                hours = String(hours).split('').length < 1 ? "00" :
                    String(hours).split('').length < 2 ? "0" + hours : hours;
                var minutes = date.getMinutes();
                minutes = String(minutes).split('').length < 1 ? "00" :
                    String(minutes).split('').length < 2 ? "0" + minutes : minutes;
                return day + '/' + month + '/' + year + ' ' + hours + ':' + minutes;
            },
            _handleClick: function (e) {
                var model = e.model;
                var text = window.encodeURIComponent(model.get('tag').split(' ').join('-'));
                window.location.hash = '#/?tag=' + text;
            }
        });
    </script>
</dom-module>
